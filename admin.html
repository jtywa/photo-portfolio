<!DOCTYPE html>
<html>
	<head>
		<title>Photo Admin</title>
	</head>
	<body>
		<h1>Photo Admin</h1>

		<h2>Upload New Photo</h2>
		<input type="file" id="photoFile" />
		<select id="photoCategory">
			<option value="sunsets">Sunsets</option>
			<option value="mountains">Mountains</option>
		</select>
		<button id="uploadBtn">Upload</button>

		<h2>Existing Photos</h2>
		<select id="filterCategory">
			<option value="all">All Categories</option>
			<option value="sunsets">Sunsets</option>
			<option value="mountains">Mountains</option>
		</select>

		<ul id="photoList"></ul>

		<script>
			async function loadPhotos() {
				const res = await fetch("https://raw.githubusercontent.com/YOUR_USERNAME/photo-portfolio/main/data/photos.json");
				const photos = await res.json();

				const filter = document.getElementById("filterCategory").value;
				const list = document.getElementById("photoList");
				list.innerHTML = "";

				photos
					.filter((photo) => filter === "all" || photo.category === filter)
					.forEach((photo) => {
						const li = document.createElement("li");
						li.innerHTML = `
                            [${photo.category}] ${photo.url.split("/").pop()} 
                            <button onclick="deletePhoto('${photo.url.split("/").pop()}')">Delete</button>
                        `;
						list.appendChild(li);
					});
			}

			async function deletePhoto(fileName) {
				if (!confirm(`Delete ${fileName}?`)) return;
				const res = await fetch("/.netlify/functions/deletePhoto", {
					method: "POST",
					headers: { "Content-Type": "application/json" },
					body: JSON.stringify({ fileName }),
				});
				if (res.ok) {
					alert("Photo deleted!");
					loadPhotos();
				} else {
					alert("Delete failed!");
				}
			}

			document.getElementById("filterCategory").onchange = loadPhotos;

			document.getElementById("uploadBtn").onclick = () => {
				const file = document.getElementById("photoFile").files[0];
				const category = document.getElementById("photoCategory").value;
				if (!file) return alert("Select a file!");

				const reader = new FileReader();
				reader.onloadend = async () => {
					const content = reader.result.split(",")[1];
					const res = await fetch("/.netlify/functions/addPhoto", {
						method: "POST",
						headers: { "Content-Type": "application/json" },
						body: JSON.stringify({
							fileName: file.name,
							fileContent: content,
							category,
						}),
					});

					if (res.ok) {
						alert("Photo uploaded!");
						loadPhotos();
					} else {
						alert("Upload failed!");
					}
				};
				reader.readAsDataURL(file);
			};

			// Load photo list when page opens
			loadPhotos();
		</script>
	</body>
</html>
